# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 7

1. –î–µ–ª–∞–ª –ø–æ –ª–µ–∫—Ü–∏–∏. –£—Å—Ç–∞–Ω–æ–≤–∏–ª minikube –∏ Docker –¥–ª—è Win. 
2. –ü—Ä–æ–≤–µ—Ä–∏–ª —Å—Ç–∞—Ç—É—Å minikube
```
D:\PG2\kub2>minikube status
```
–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```
type: Control Plane   
host: Running
kubelet: Running      
apiserver: Running    
kubeconfig: Configured
```
3. –î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–π –ü–û–î postgres.yaml
```
D:\PG2\kub2\postgres>kubectl apply -f postgres.yaml
```
```
service/postgres created
statefulset.apps/postgres-statefulset created
```
–°–∞–º —Ñ–∞–π–ª postgres.yaml
```
apiVersion: v1
kind: Service
metadata:
  name: postgres
  labels:
    app: postgres
spec:
  type: NodePort
  ports:
   - port: 5432
  selector:
    app: postgres

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres-statefulset
spec:
  serviceName: "postgres"
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:latest
        ports:
        - containerPort: 5432
          name: postgredb
        env:
          - name: POSTGRES_DB
            value: myapp
          - name: POSTGRES_USER
            value: myuser
          - name: POSTGRES_PASSWORD
            value: passwd
        volumeMounts:
        - name: postgredb
          mountPath: /var/lib/postgresql/data
          subPath: postgres
  volumeClaimTemplates:
  - metadata:
      name: postgredb
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: standard
      resources:
        requests:
          storage: 1Gi
```
–ü–æ –¥–∞–Ω–Ω–æ–º—É –º–∞–Ω–∏—Ñ–µ—Å—Ç—É —è —Å–æ–∑–¥–∞—é Postgre –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏. –ë–î myapp, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å myuser, –ü–∞—Ä–æ–ª—å passwd.
–Ø –º–µ–Ω—è–ª –Ω–∞–∑–≤–∞–Ω–∏—è –ë–î,–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å, –≤–æ–æ–±—â–µ –Ω–æ–ª—å —Ä–µ–∞–∫—Ü–∏–∏. –í—Å–µ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ë–î myapp, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å myuser, –ü–∞—Ä–æ–ª—å passwd.
–Ø –ø–æ–∫–∞ —Ç–∞–∫ –∏ –Ω–µ –ø–æ–Ω—è–ª –ø–æ—á–µ–º—É
4. –ü—Ä–æ–≤–µ—Ä—è—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–¥—ã
```
D:\PG2\kub2\postgres>kubectl get pods
NAME                     READY   STATUS
     RESTARTS   AGE
hello-demo               1/1     Running        
     0          87m
postgres-statefulset-0   0/1     ContainerCreating   0          43s
```
–°–º–æ—Ç—Ä—é –≤ –¥–∞—à–±–æ—Ä–¥–µ
```
D:\PG2\kub2\postgres\app>minikube dashboard
ü§î  Verifying dashboard health ...
üöÄ  Launching proxy ...
ü§î  Verifying proxy health ...
üéâ  Opening http://127.0.0.1:64728/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
```
![2023-06-02_16-25-04](https://github.com/sfedorovceavtru/otus_pg2/assets/122378097/12514e7a-4aee-413b-9308-52065aaa44ac)

5. –ü–µ—Ä–µ–∫–∏–¥—ã–≤–∞—é –ø–æ—Ä—Ç—ã, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Å—Ç–≥—Ä–µ
```
D:\PG2\kub2\postgres>minikube service postgres --url -n pg-kub1
http://127.0.0.1:61700
‚ùó  Because you are using a Docker driver on  it.
windows, the terminal needs to be open to run it.
```
7. –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ –ø–æ—Å—Ç–≥—Ä–µ –∏ —Å–º–æ—Ç—Ä—é —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å
```
D:\PG2\kub2>"D:\PostgreSQL\bin\psql.exe" -h 127.0.0.1 -p 61700 -U myuser -W myapp
Password: 
psql (15.2, server 15.3 (Debian 15.3-1.pgdg110+1))
WARNING: Console code page (866) differs from Windows code page (1251)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

myapp=# \l
                                             List of databases
   Name    | Owner  | Encoding |  Collate   |   
Ctype    | ICU Locale | Locale Provider | Access privileges
-----------+--------+----------+------------+------------+------------+-----------------+-------------------
 myapp     | myuser | UTF8     | en_US.utf8 | en_US.utf8 |            | libc            |       
 postgres  | myuser | UTF8     | en_US.utf8 | en_US.utf8 |            | libc            |       
 template0 | myuser | UTF8     | en_US.utf8 | en_US.utf8 |            | libc            | =c/myuser        +
           |        |          |            |   
         |            |                 | myuser=CTc/myuser
 template1 | myuser | UTF8     | en_US.utf8 | en_US.utf8 |            | libc            | =c/myuser        +
           |        |          |            |   
         |            |                 | myuser=CTc/myuser
(4 rows)
```
–í–∏–∂—É,—á—Ç–æ –ø–æ—Å—Ç–≥—Ä–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –ë–î myapp —Å–æ–∑–¥–∞–Ω–∞

