# Домашнее задание 2

1. Подключился к виртуальной машине 
2. Поставил на нем Docker Engine
3. Создал каталог /var/lib/postgres. Как я понял это каталог для хранения данных
4. Устанавил образ Postgres из Docker Hub
```
sudo docker pull postgres
```
Проверяю, образ появился
```
sudo docker images
REPOSITORY   TAG       IMAGE ID       CREATED      SIZE
postgres     latest    bf700010ce28   2 days ago   379MB
```

5. Развернул контейнер 
```
 sudo docker run --rm --name otus-postgres2 -e POSTGRES_PASSWORD=12345 -e POSTGRES_USER=postgres -e POSTGRES_DB=test_db -d -p 5433:5433 -v /data:/var/lib/postgres/data postgres
```
Ответ:
```
8512d66c21fe9bddf50e632d2cf8818770e5391c53c4d425903377a82de25e78
```
Проверяю,контейнер появился
```
$ sudo docker ps
CONTAINER ID   IMAGE      COMMAND                  CREATED         STATUS         PORTS                                                 NAMES
8512d66c21fe   postgres   "docker-entrypoint.s…"   2 minutes ago   Up 2 minutes   5432/tcp, 0.0.0.0:5433->5433/tcp, :::5433->5433/tcp   otus-postgres2
```
**Но в /var/lib/postgres пусто. Что-то не правильно делаю?**

6. Дальше нужно развернуть контейнер с клиентом postgres. **Это просто новый контейнер надо сделать? Или там чем-то отличается создание контейнера для клиента?**
Пока сделал так
```
sudo docker run --rm --name otus-postgres2-client -e POSTGRES_PASSWORD=12345 -e POSTGRES_USER=postgres -d -p 5434:5434 postgres
```
Ответ
```
c3ce50d7b880d3e7aa5e2f41f69f6414daff68ce40bbc0891e8a17bed2f3fa8a
```
Проверяю контейнеры
```
$ sudo docker ps
CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS          PORTS                                                 NAMES
c3ce50d7b880   postgres   "docker-entrypoint.s…"   58 seconds ago   Up 57 seconds   5432/tcp, 0.0.0.0:5434->5434/tcp, :::5434->5434/tcp   otus-postgres2-client
8512d66c21fe   postgres   "docker-entrypoint.s…"   14 minutes ago   Up 14 minutes   5432/tcp, 0.0.0.0:5433->5433/tcp, :::5433->5433/tcp   otus-postgres2
```
Захожу в контейнер клиента
```
$ sudo docker exec -it c3ce50d7b880 bash
```
Устанавливаю клиент постгре
```
apt install postgresql-client
```

7. Нужно подключится из контейнера с клиентом к контейнеру с сервером и сделать таблицу с парой строк. 
Сначала делаю сеть 
```$ sudo docker network create postgres_network
```
Ответ
```
83f312ef41c04bf82a4f215a31dbd26bc79a9579c15f3d14940d842e67c32bcd
```
Проверяю через inspect
```
~$ sudo docker network inspect postgres_network
[
    {
        "Name": "postgres_network",
        "Id": "83f312ef41c04bf82a4f215a31dbd26bc79a9579c15f3d14940d842e67c32bcd",
        "Created": "2023-05-05T13:43:18.277069644Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.19.0.0/16",
                    "Gateway": "172.19.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {},
        "Labels": {}
    }
]
```
Добавляю оба контейнера в сеть и еще раз проверяю
```
otus@otus-db-pg-vm-1:~$ sudo docker network connect postgres_network otus-postgres2
otus@otus-db-pg-vm-1:~$ sudo docker network connect postgres_network otus-postgres2-client
otus@otus-db-pg-vm-1:~$ sudo docker network inspect postgres_network
[
    {
        "Name": "postgres_network",
        "Id": "83f312ef41c04bf82a4f215a31dbd26bc79a9579c15f3d14940d842e67c32bcd",
        "Created": "2023-05-05T13:43:18.277069644Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.19.0.0/16",
                    "Gateway": "172.19.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "8512d66c21fe9bddf50e632d2cf8818770e5391c53c4d425903377a82de25e78": {
                "Name": "otus-postgres2",
                "EndpointID": "3ffdfc6f9eb50db85b789c6c0d36bde6e2056079619009238953f850023ff556",
                "MacAddress": "02:42:ac:13:00:02",
                "IPv4Address": "172.19.0.2/16",
                "IPv6Address": ""
            },
            "c3ce50d7b880d3e7aa5e2f41f69f6414daff68ce40bbc0891e8a17bed2f3fa8a": {
                "Name": "otus-postgres2-client",
                "EndpointID": "036e675694a736999fa91e616ec209236d00748f3c88f9d3451bebfbfaade235",
                "MacAddress": "02:42:ac:13:00:03",
                "IPv4Address": "172.19.0.3/16",
                "IPv6Address": ""
            }
        },
        "Options": {},
        "Labels": {}
    }
]
```

**А как потом из одного контейнера в другой обратиться?** Тут уже не могу понять

8. Из первого контейнера (не клиент) подключился к постгрес и смог создать там таблицу с данными
```
sudo docker exec -it otus-postgres2 psql -U postgres

postgres=# create table persons(id serial, first_name text, second_name text);
postgres=# insert into persons(first_name, second_name) values('ivan', 'ivanov');
postgres=# insert into persons(first_name, second_name) values('petr', 'petrov');

postgres=# select * from persons;
 id | first_name | second_name
----+------------+-------------
  1 | ivan       | ivanov
  2 | petr       | petrov
(2 rows)
```
Но если я удалю контейнер и создам новый, то там уже неичего не будет. Где-то не то реализовал

9. И не смог понять, как в виртуальную машину передать и запустить **docker-compose.yaml**
В лекции Владимир просто запустил "docker-compose up -d", но мне же его где-то надо создать получается
